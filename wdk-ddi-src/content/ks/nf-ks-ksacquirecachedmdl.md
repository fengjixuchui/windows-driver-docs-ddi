---
UID: NF:ks.KsAcquireCachedMdl
title: KsAcquireCachedMdl function (ks.h)
description: This function is used to acquire the MDL cached by the KS port driver. The function is used by a kernel mode driver to acquire the MDL for a pipeline-supplied sample generated by an Avstream driver.
old-location: stream\ksacquirecachedmdl.htm
tech.root: stream
ms.assetid: C6C693CC-D9C0-4EE8-9F8C-07D8665C673D
ms.date: 04/23/2018
ms.keywords: GUID, KsAcquireCachedMdl, KsAcquireCachedMdl function [Streaming Media Devices], PVOID, ks/KsAcquireCachedMdl, stream.ksacquirecachedmdl
ms.topic: function
f1_keywords:
 - "ks/KsAcquireCachedMdl"
req.header: ks.h
req.include-header: 
req.target-type: Universal
req.target-min-winverclnt: 
req.target-min-winversvr: 
req.kmdf-ver: 
req.umdf-ver: 
req.ddi-compliance: 
req.unicode-ansi: 
req.idl: 
req.max-support: 
req.namespace: 
req.assembly: 
req.type-library: 
req.lib: Ks.lib
req.dll: 
req.irql: 
topic_type:
- APIRef
- kbSyntax
api_type:
- LibDef
api_location:
- ks.lib
- ks.dll
api_name:
- KsAcquireCachedMdl
product:
- Windows
targetos: Windows
req.typenames: 
---

# KsAcquireCachedMdl function

## -description

This function is used to acquire the MDL cached by the KS port driver. The function is used by a kernel mode driver to acquire the MDL for a pipeline-supplied sample generated by an Avstream driver.

## -parameters

### -param Irp

The IRP passed from the user mode containing the user-mode sample buffer.

### -param Guid

The GUID extracted from the **MFSampleExtension_MDLCacheCookie** attribute item of the **IMFSample** passed by the pipeline.

### -param CancelRoutine

Cancel routine, a callback function supplied by the Avstream miniport driver. This function is called when the state of the pin generating the sample is going to STOP state.  The signature of the cancel routine is as follows:

```cpp
_IRQL_requires_max_(DISPATCH_LEVEL)
typedef
VOID
(*PFNKSCANCELPINNEDMDL)(
    _In_ GUID,
    _In_ PVOID,
    _In_ PVOID
);
```

#### GUID

GUID passed in the **KsAcquireCachedMdl** function by the Avstream miniport driver.

#### PVOID

Cancel context supplied by the Avstream miniport driver in the **KsAcquireCachedMdl** function call.

Release context. This is the output of the **KsAcquireCachedMdl** function.

### -param CancelContext

The context passed to the Avstream driver in the cancel routine. This context is used by the Avstream driver to get into the driver context.

### -param MdlAddr

### -param ReleaseContext

Return value: The context to be stored by Avstream driver. This context should be passed to KS when releasing the MDL acquired by the **KsAcquireCachedMdl** call.

#### - *MdlAddr

Return value: The resultant MDL if KS finds the MDL stored for the sample buffer.

## -returns

 Returns STATUS_SUCCESS for success conditions.
