---
UID: NI:storport.IOCTL_SCSI_MINIPORT_DSM
title: IOCTL_SCSI_MINIPORT_DSM (storport.h)
description: A Data Set Management (DSM) notification is transferred to a miniport driver in a IOCTL_SCSI_MINIPORT_DSM control code request.
old-location: storage\ioctl_scsi_miniport_dsm.htm
tech.root: storage
ms.assetid: CA91B623-F926-453D-A348-92655875D801
ms.date: 03/29/2018
keywords: ["IOCTL_SCSI_MINIPORT_DSM IOCTL"]
ms.keywords: IOCTL_SCSI_MINIPORT_DSM, IOCTL_SCSI_MINIPORT_DSM control, IOCTL_SCSI_MINIPORT_DSM control code [Storage Devices], scsi/IOCTL_SCSI_MINIPORT_DSM, storage.ioctl_scsi_miniport_dsm
req.header: storport.h
req.include-header: Ntddscsi.h, Storport.h
req.target-type: Windows
req.target-min-winverclnt: Available starting with Windows 8.1.
req.target-min-winversvr: 
req.kmdf-ver: 
req.umdf-ver: 
req.ddi-compliance: 
req.unicode-ansi: 
req.idl: 
req.max-support: 
req.namespace: 
req.assembly: 
req.type-library: 
req.lib: 
req.dll: 
req.irql: 
targetos: Windows
req.typenames: 
f1_keywords:
 - IOCTL_SCSI_MINIPORT_DSM
 - storport/IOCTL_SCSI_MINIPORT_DSM
topic_type:
 - APIRef
 - kbSyntax
api_type:
 - HeaderDef
api_location:
 - scsi.h
api_name:
 - IOCTL_SCSI_MINIPORT_DSM
---

# IOCTL_SCSI_MINIPORT_DSM IOCTL (storport.h)


## -description

A Data Set Management (DSM) notification is transferred to a miniport driver in a 
     <b>IOCTL_SCSI_MINIPORT_DSM</b> control code request. The <b>IOCTL_SCSI_MINIPORT_DSM</b> request is a sub-IOCTL of <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ni-ntddscsi-ioctl_scsi_miniport">IOCTL_SCSI_MINIPORT</a>. This IOCTL generated by StorPort in response to a DSM action, then sent  to the miniport as a <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/srb/ns-srb-_storage_request_block">STORAGE_REQUEST_BLOCK</a> (SRB) with a function type of SRB_FUNCTION_IO_CONTROL. The input and output data is contained in the SRB data block. 
<div class="alert"><b>Note</b>  The SCSI port driver and SCSI miniport driver models may be altered or unavailable in the future. Instead, we recommend using the <a href="https://docs.microsoft.com/windows-hardware/drivers/storage/storport-driver">Storport driver</a> and <a href="https://docs.microsoft.com/windows-hardware/drivers/storage/storport-miniport-drivers">Storport miniport</a> driver models.</div><div> </div>

## -ioctlparameters

### -input-buffer

The buffer specified in the <b>DataBuffer</b> member of the SRB must contain an <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a> structure and a <b>DSM_NOTIFICATION_REQUEST_BLOCK</b> structure.

### -input-buffer-length

<b>DataTransferLength</b> indicates the size, in bytes, of the buffer, which must be at least <b>sizeof</b> (SRB_IO_CONTROL) + <b>sizeof</b>(DSM_NOTIFICATION_REQUEST_BLOCK), with additional storage for the <b>MP_DEVICE_DATA_SET_RANGE</b> structures included.

### -output-buffer

An updated <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a> structure is returned to the data buffer in the SRB. The <b>SrbStatus</b> contains the result of the miniport's processing of the request.

### -output-buffer-length

The length of an <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a> structure.

### -in-out-buffer

### -inout-buffer-length

### -status-block

The resulting status of the function request is set in the <b>SrbStatus</b> member of <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a>. The following are the  DSM disk IOCTL status codes.

<table>
<tr>
<th>SRB Status</th>
<th>Description</th>
</tr>
<tr>
<td>SRB_STATUS_SUCCESS</td>
<td>The request completed successfully.</td>
</tr>
<tr>
<td>SRB_STATUS_INVALID_REQUEST</td>
<td>The request contains an invalid buffer size</td>
</tr>
</table>

## -remarks

<b>DSM_NOTIFICATION_REQUEST_BLOCK</b>

A <b>DSM_NOTIFICATION_REQUEST_BLOCK</b> structure immediately follows the <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a> structure in the data buffer of the SRB.  <b>DSM_NOTIFICATION_REQUEST_BLOCK</b> is defined in ntddscsi.h as the following.

<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>typedef struct _DSM_NOTIFICATION_REQUEST_BLOCK {
    ULONG   Version;
    ULONG   Size;
    ULONG   NotifyFLags;
    ULONG   DataSetProfile;
    ULONG   Reserved[3];
    ULONG   DataSetRangesCount;
    MP_DEVICE_DATA_SET_RANGE DataSetRanges[ANYSIZE_ARRAY];
} DSM_NOTIFICATION_REQUEST_BLOCK, *PDSM_NOTIFICATION_REQUEST_BLOCK;</pre>
</td>
</tr>
</table></span></div>


<b>MP_DEVICE_DATA_SET_RANGE</b>

The LBA ranges are included in the  in <b>DataSetRanges</b> member of <b>DSM_NOTIFICATION_REQUEST_BLOCK</b> as an array of <b>MP_DEVICE_DATA_SET_RANGE</b> structures. <b>MP_DEVICE_DATA_SET_RANGE</b> is defined in ntddscsi.h as the following.

<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>rypedef struct _MP_DEVICE_DATA_SET_RANGE {
    LONGLONG    StartingOffset;
    ULONGLONG   LengthInBytes;
} MP_DEVICE_DATA_SET_RANGE, *PMP_DEVICE_DATA_SET_RANGE;</pre>
</td>
</tr>
</table></span></div>


The <b>DSM_NOTIFICATION_REQUEST_BLOCK</b> structure is located after the <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a> structure in the <b>DataBuffer</b> of the SRB.

The <a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a> structure for this IOCTL contains IOCTL_MINIPORT_SIGNATURE_DSM_NOTIFICATION in its <b>Signature</b> member and <b>IOCTL_SCSI_MINIPORT_DSM</b> in the <b>ControlCode</b> member.

## -see-also

<a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ni-ntddscsi-ioctl_scsi_miniport">IOCTL_SCSI_MINIPORT</a>



<a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_srb_io_control">SRB_IO_CONTROL</a>



<a href="https://docs.microsoft.com/windows-hardware/drivers/ddi/srb/ns-srb-_storage_request_block">STORAGE_REQUEST_BLOCK</a>

